{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebPlugin } from '@capacitor/core';\r\nimport { BarcodeFormat, BrowserQRCodeReader, IScannerControls } from '@zxing/browser';\r\nimport { DecodeHintType } from '@zxing/library';\r\n\r\nimport {\r\n  BarcodeScannerPlugin,\r\n  ScanOptions,\r\n  ScanResult,\r\n  CheckPermissionOptions,\r\n  CheckPermissionResult,\r\n  StopScanOptions,\r\n  TorchStateResult,\r\n  CameraDirection,\r\n  IScanResultWithContent,\r\n} from './definitions';\r\n\r\nexport class BarcodeScannerWeb extends WebPlugin implements BarcodeScannerPlugin {\r\n  private static _FORWARD = { facingMode: 'user' };\r\n  private static _BACK = { facingMode: 'environment' };\r\n  private _formats: number[] = [];\r\n  private _controls: IScannerControls | null = null;\r\n  private _torchState = false;\r\n  private _video: HTMLVideoElement | null = null;\r\n  private _options: ScanOptions | null = null;\r\n  private _backgroundColor: string | null = null;\r\n  private _facingMode: MediaTrackConstraints = BarcodeScannerWeb._BACK;\r\n\r\n  async prepare(): Promise<void> {\r\n    await this._getVideoElement();\r\n    return;\r\n  }\r\n\r\n  async hideBackground(): Promise<void> {\r\n    this._backgroundColor = document.documentElement.style.backgroundColor;\r\n    document.documentElement.style.backgroundColor = 'transparent';\r\n    return;\r\n  }\r\n\r\n  async showBackground(): Promise<void> {\r\n    document.documentElement.style.backgroundColor = this._backgroundColor || '';\r\n    return;\r\n  }\r\n\r\n  async startScan(_options: ScanOptions): Promise<ScanResult> {\r\n    this._options = _options;\r\n    this._formats = [];\r\n    _options?.targetedFormats?.forEach((format) => {\r\n      const formatIndex = Object.keys(BarcodeFormat).indexOf(format);\r\n      if (formatIndex >= 0) {\r\n        this._formats.push(0);\r\n      } else {\r\n        console.error(format, 'is not supported on web');\r\n      }\r\n    });\r\n    if (!!_options?.cameraDirection) {\r\n      this._facingMode = _options.cameraDirection === CameraDirection.BACK ? BarcodeScannerWeb._BACK : BarcodeScannerWeb._FORWARD;\r\n    }\r\n    const video = await this._getVideoElement();\r\n    if (video) {\r\n      return await this._getFirstResultFromReader();\r\n    } else {\r\n      throw this.unavailable('Missing video element');\r\n    }\r\n  }\r\n\r\n  async startScanning(_options: ScanOptions, _callback: any): Promise<string> {\r\n    throw this.unimplemented('Not implemented on web.');\r\n  }\r\n\r\n  async pauseScanning(): Promise<void> {\r\n    if (this._controls) {\r\n      this._controls.stop();\r\n      this._controls = null;\r\n    }\r\n  }\r\n\r\n  async resumeScanning(): Promise<void> {\r\n    this._getFirstResultFromReader();\r\n  }\r\n\r\n  async stopScan(_options?: StopScanOptions): Promise<void> {\r\n    this._stop();\r\n    if (this._controls) {\r\n      this._controls.stop();\r\n      this._controls = null;\r\n    }\r\n  }\r\n\r\n  async checkPermission(_options: CheckPermissionOptions): Promise<CheckPermissionResult> {\r\n    if (typeof navigator === 'undefined' || !navigator.permissions) {\r\n      throw this.unavailable('Permissions API not available in this browser');\r\n    }\r\n\r\n    try {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/Permissions/query\r\n      // the specific permissions that are supported varies among browsers that implement the\r\n      // permissions API, so we need a try/catch in case 'camera' is invalid\r\n      const permission = await window.navigator.permissions.query({\r\n        name: 'camera' as any,\r\n      });\r\n      if (permission.state === 'prompt') {\r\n        return {\r\n          neverAsked: true,\r\n        };\r\n      }\r\n      if (permission.state === 'denied') {\r\n        return {\r\n          denied: true,\r\n        };\r\n      }\r\n      if (permission.state === 'granted') {\r\n        return {\r\n          granted: true,\r\n        };\r\n      }\r\n      return {\r\n        unknown: true,\r\n      };\r\n    } catch {\r\n      throw this.unavailable('Camera permissions are not available in this browser');\r\n    }\r\n  }\r\n\r\n  async openAppSettings(): Promise<void> {\r\n    throw this.unavailable('App settings are not available in this browser');\r\n  }\r\n\r\n  async disableTorch(): Promise<void> {\r\n    if (this._controls && this._controls.switchTorch) {\r\n      this._controls.switchTorch(false);\r\n      this._torchState = false;\r\n    }\r\n  }\r\n\r\n  async enableTorch(): Promise<void> {\r\n    if (this._controls && this._controls.switchTorch) {\r\n      this._controls.switchTorch(true);\r\n      this._torchState = true;\r\n    }\r\n  }\r\n\r\n  async toggleTorch(): Promise<void> {\r\n    if (this._controls && this._controls.switchTorch) {\r\n      this._controls.switchTorch(true);\r\n    }\r\n  }\r\n\r\n  async getTorchState(): Promise<TorchStateResult> {\r\n    return { isEnabled: this._torchState };\r\n  }\r\n\r\n  private async _getVideoElement() {\r\n    if (!this._video) {\r\n      await this._startVideo();\r\n    }\r\n    return this._video;\r\n  }\r\n\r\n  private async _getFirstResultFromReader() {\r\n    const videoElement = await this._getVideoElement();\r\n    return new Promise<IScanResultWithContent>(async (resolve) => {\r\n      if (videoElement) {\r\n        let hints;\r\n        if (this._formats.length) {\r\n          hints = new Map();\r\n          hints.set(DecodeHintType.POSSIBLE_FORMATS, this._formats);\r\n        }\r\n        const reader = new BrowserQRCodeReader(hints);\r\n        this._controls = await reader.decodeFromVideoElement(videoElement, (result, error, controls) => {\r\n          if (!error && result && result.getText()) {\r\n            resolve({\r\n              hasContent: true,\r\n              content: result.getText(),\r\n              format: result.getBarcodeFormat().toString(),\r\n            });\r\n            controls.stop();\r\n            this._controls = null;\r\n            this._stop();\r\n          }\r\n          if (error && error.message) {\r\n            console.error(error.message);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private async _startVideo(): Promise<{}> {\r\n    return new Promise(async (resolve, reject) => {\r\n      await navigator.mediaDevices\r\n        .getUserMedia({\r\n          audio: false,\r\n          video: true,\r\n        })\r\n        .then((stream: MediaStream) => {\r\n          // Stop any existing stream so we can request media with different constraints based on user input\r\n          stream.getTracks().forEach((track) => track.stop());\r\n        })\r\n        .catch((error) => {\r\n          reject(error);\r\n        });\r\n\r\n      const body = document.body;\r\n      const video = document.getElementById('video');\r\n\r\n      if (!video) {\r\n        const parent = document.createElement('div');\r\n        parent.setAttribute(\r\n          'style',\r\n          'position:absolute; top: 0; left: 0; width:100%; height: 100%; background-color: black;'\r\n        );\r\n        this._video = document.createElement('video');\r\n        this._video.id = 'video';\r\n        // Don't flip video feed if camera is rear facing\r\n        if (this._options?.cameraDirection !== CameraDirection.BACK) {\r\n          this._video.setAttribute(\r\n            'style',\r\n            '-webkit-transform: scaleX(-1); transform: scaleX(-1); width:100%; height: 100%;'\r\n          );\r\n        } else {\r\n          this._video.setAttribute('style', 'width:100%; height: 100%;');\r\n        }\r\n\r\n        const userAgent = navigator.userAgent.toLowerCase();\r\n        const isSafari = userAgent.includes('safari') && !userAgent.includes('chrome');\r\n\r\n        // Safari on iOS needs to have the autoplay, muted and playsinline attributes set for video.play() to be successful\r\n        // Without these attributes this.video.play() will throw a NotAllowedError\r\n        // https://developer.apple.com/documentation/webkit/delivering_video_content_for_safari\r\n        if (isSafari) {\r\n          this._video.setAttribute('autoplay', 'true');\r\n          this._video.setAttribute('muted', 'true');\r\n          this._video.setAttribute('playsinline', 'true');\r\n        }\r\n\r\n        parent.appendChild(this._video);\r\n        body.appendChild(parent);\r\n\r\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n          const constraints: MediaStreamConstraints = {\r\n            video: this._facingMode,\r\n          };\r\n\r\n          navigator.mediaDevices.getUserMedia(constraints).then(\r\n            (stream) => {\r\n              //video.src = window.URL.createObjectURL(stream);\r\n              if (this._video) {\r\n                this._video.srcObject = stream;\r\n                this._video.play();\r\n              }\r\n              resolve({});\r\n            },\r\n            (err) => {\r\n              reject(err);\r\n            }\r\n          );\r\n        }\r\n      } else {\r\n        reject({ message: 'camera already started' });\r\n      }\r\n    });\r\n  }\r\n\r\n  private async _stop(): Promise<any> {\r\n    if (this._video) {\r\n      this._video.pause();\r\n\r\n      const st: any = this._video.srcObject;\r\n      const tracks = st.getTracks();\r\n\r\n      for (var i = 0; i < tracks.length; i++) {\r\n        var track = tracks[i];\r\n        track.stop();\r\n      }\r\n      this._video.parentElement?.remove();\r\n      this._video = null;\r\n    }\r\n  }\r\n}\r\n"]}